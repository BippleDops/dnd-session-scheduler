<!DOCTYPE html>
<html lang="en">
<head><%- include('partials/head') %><title>Configuration â€” D&D Session Scheduler</title></head>
<body>
  <%- include('partials/header') %>
  <main class="container">
    <div class="page-header"><h2>Configuration</h2><p style="color:var(--color-text-muted);">Edit application settings. Changes take effect immediately.</p></div>
    <div class="table-wrap"><table class="data-table"><thead><tr><th>Key</th><th>Value</th><th>Description</th><th>Actions</th></tr></thead><tbody id="config-tbody"></tbody></table></div>
  </main>
  <%- include('partials/footer') %>
  <script>
    var allConfig = [];
    (function() {
      showLoading();
      fetch('/api/admin/config').then(function(r){return r.json();}).then(function(rows) {
        hideLoading(); allConfig = rows || []; renderConfig();
      }).catch(function(e) { hideLoading(); showToast(e.message, 'error'); });
    })();
    function renderConfig() {
      var tbody = document.getElementById('config-tbody');
      if (allConfig.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No configuration found</td></tr>'; return; }
      tbody.innerHTML = allConfig.map(function(c, idx) {
        return '<tr><td><code style="font-size:0.85rem;background:var(--color-surface-alt);padding:2px 6px;border-radius:4px;">' + escHtml(c.key) + '</code></td><td><input type="text" class="form-input" id="val-' + idx + '" value="' + escHtml(c.value || '').replace(/"/g, '&quot;') + '" style="min-width:200px;font-size:0.85rem;"></td><td style="font-size:0.85rem;color:var(--color-text-muted);">' + escHtml(c.description || '') + '</td><td><button class="btn btn-sm btn-primary" onclick="saveRow(' + idx + ')">Save</button></td></tr>';
      }).join('');
    }
    function saveRow(idx) {
      var c = allConfig[idx]; if (!c) return;
      var newVal = document.getElementById('val-' + idx).value;
      showLoading();
      fetch('/api/admin/config/' + encodeURIComponent(c.key), { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ value: newVal }) }).then(function(r){return r.json();}).then(function(r) { hideLoading(); if (r.success) { allConfig[idx].value = newVal; showToast(c.key + ' saved', 'success'); } }).catch(function(e) { hideLoading(); showToast(e.message, 'error'); });
    }
  </script>
</body>
</html>

