(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9064,e=>{"use strict";var t=e.i(5111),a=e.i(59053);function s({children:e,className:s,pinned:n=!1,title:i}){return(0,t.jsxs)("div",{className:(0,a.cn)(n?"quest-card":"parchment","p-5 mb-4",s),children:[i&&(0,t.jsx)("h2",{className:"font-[var(--font-heading)] text-lg text-[var(--gold)] mb-3",children:i}),e]})}e.s(["default",()=>s])},54520,e=>{"use strict";var t=e.i(5111),a=e.i(59053);function s({variant:e="default",href:s,className:n,children:i,...l}){let r=(0,a.cn)("wood-btn","primary"===e&&"wood-btn-primary","secondary"===e&&"opacity-70 hover:opacity-100","danger"===e&&"wood-btn-danger","sm"===e&&"text-sm py-1 px-3",n);return s?(0,t.jsx)("a",{href:s,className:r,children:i}):(0,t.jsx)("button",{className:r,...l,children:i})}e.s(["default",()=>s])},72937,e=>{"use strict";var t=e.i(98552),a=e.i(5111),s=e.i(55703),n=e.i(4629),i=e.i(8779),l=e.i(84249),r=e.i(9064),d=e.i(54520);let c=["Blinded","Charmed","Deafened","Frightened","Grappled","Incapacitated","Invisible","Paralyzed","Petrified","Poisoned","Prone","Restrained","Stunned","Unconscious","Concentrating"];function x(){return(0,a.jsx)(s.Suspense,{children:(0,a.jsx)(o,{})})}function o(){let e=(0,n.useSearchParams)().get("sessionId")||"",{isAdmin:x}=(0,l.useAuth)(),[o,p]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[u,v]=(0,s.useState)([]),[g,j]=(0,s.useState)(0),[N,f]=(0,s.useState)(1),[y,b]=(0,s.useState)(0),[w,C]=(0,s.useState)({name:"",initiative:"",hp:"",maxHp:"",isNpc:!1}),[S,k]=(0,s.useState)(""),_=(0,s.useCallback)(()=>{e&&((0,i.getInitiativeEntries)(e).then(p),(0,i.getDiceHistory)(e).then(m),(0,i.getSessionComments)(e).then(v))},[e]);(0,s.useEffect)(()=>{_()},[_]),(0,s.useEffect)(()=>{if(!e)return;let a=t.default.env.NEXT_PUBLIC_API_URL||"",s=new EventSource(`${a}/api/sse/${e}`,{withCredentials:!0});return s.addEventListener("initiative_update",e=>{try{p(JSON.parse(e.data))}catch{}}),s.addEventListener("dice_roll",e=>{try{m(t=>[JSON.parse(e.data),...t].slice(0,30))}catch{}}),s.addEventListener("presence",e=>{try{b(JSON.parse(e.data).count)}catch{}}),()=>s.close()},[e]);let I=async t=>{t.preventDefault(),await (0,i.addInitiativeEntry)(e,w),C({name:"",initiative:"",hp:"",maxHp:"",isNpc:!1}),_()},P=async(e,t)=>{await (0,i.updateInitiativeEntry)(e.entry_id,{hp:Math.max(0,e.hp+t)})},E=async(e,t)=>{let a=Array.isArray(e.conditions)?e.conditions:[],s=a.includes(t)?a.filter(e=>e!==t):[...a,t];await (0,i.updateInitiativeEntry)(e.entry_id,{conditions:s})},A=async t=>{t.preventDefault(),S.trim()&&(await (0,i.postSessionComment)(e,S),k(""),_())};return e?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"font-[var(--font-heading)] text-2xl text-[var(--gold)]",children:"âš”ï¸ Live Session"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,a.jsxs)("span",{className:"text-green-400",children:["â— ",y," online"]}),(0,a.jsxs)("span",{className:"text-[var(--gold)]",children:["Round ",N]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2 space-y-4",children:(0,a.jsxs)(r.default,{title:"Initiative Order",children:[x&&o.length>0&&(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsx)(d.default,{onClick:()=>{0===g&&N>1?(j(o.length-1),f(e=>e-1)):j(Math.max(0,g-1))},variant:"secondary",children:"â—€ Prev"}),(0,a.jsx)(d.default,{onClick:()=>{let e=g+1;e>=o.length?(j(0),f(e=>e+1)):j(e)},children:"Next â–¶"}),(0,a.jsx)(d.default,{onClick:()=>(0,i.clearInitiative)(e).then(_),variant:"secondary",children:"Clear All"})]}),0===o.length?(0,a.jsx)("p",{className:"text-[var(--ink-faded)] text-center py-4",children:"No combatants. Add entries below."}):(0,a.jsx)("div",{className:"space-y-2",children:o.map((e,t)=>{let s=t===g,n=e.max_hp>0?Math.round(e.hp/e.max_hp*100):100,l=Array.isArray(e.conditions)?e.conditions:[];return(0,a.jsxs)("div",{className:`p-3 rounded border-2 transition-all ${s?"border-[var(--gold)] bg-[var(--gold)]/10":"border-[var(--wood-dark)] bg-[var(--wood-dark)]"}`,children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,a.jsx)("span",{className:"text-[var(--gold)] animate-pulse",children:"â–¶"}),(0,a.jsx)("span",{className:"font-bold text-lg",children:e.name}),(0,a.jsxs)("span",{className:"text-[var(--gold)] text-sm",children:["Init: ",e.initiative]}),e.is_npc?(0,a.jsx)("span",{className:"text-xs bg-red-900/30 text-red-400 px-1 rounded",children:"NPC"}):null]}),x&&(0,a.jsx)("button",{onClick:()=>(0,i.deleteInitiativeEntry)(e.entry_id).then(_),className:"text-red-400 text-xs hover:text-red-300",children:"âœ•"})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,a.jsxs)("span",{children:["â¤ï¸ ",e.hp,"/",e.max_hp]}),(0,a.jsxs)("span",{children:[n,"%"]})]}),(0,a.jsx)("div",{className:"h-2 bg-[var(--wood)] rounded overflow-hidden",children:(0,a.jsx)("div",{className:`h-full transition-all ${n>50?"bg-green-500":n>25?"bg-yellow-500":"bg-red-500"}`,style:{width:`${n}%`}})}),x&&(0,a.jsx)("div",{className:"flex gap-1 mt-1",children:[-10,-5,-1,1,5,10].map(t=>(0,a.jsx)("button",{onClick:()=>P(e,t),className:`text-xs px-2 py-0.5 rounded ${t<0?"bg-red-900/30 text-red-400":"bg-green-900/30 text-green-400"}`,children:t>0?`+${t}`:t},t))})]}),(l.length>0||x)&&(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:x?c.map(t=>(0,a.jsx)("button",{onClick:()=>E(e,t),className:`text-[10px] px-1.5 py-0.5 rounded transition-colors ${l.includes(t)?"bg-purple-700 text-white":"bg-[var(--wood)] text-[var(--ink-faded)]"}`,children:t},t)):l.map(e=>(0,a.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-700 text-white",children:e},e))})]},e.entry_id)})}),x&&(0,a.jsxs)("form",{onSubmit:I,className:"mt-4 grid grid-cols-2 md:grid-cols-5 gap-2",children:[(0,a.jsx)("input",{required:!0,placeholder:"Name",className:"parchment-input",value:w.name,onChange:e=>C({...w,name:e.target.value})}),(0,a.jsx)("input",{type:"number",placeholder:"Init",className:"parchment-input",value:w.initiative,onChange:e=>C({...w,initiative:e.target.value})}),(0,a.jsx)("input",{type:"number",placeholder:"HP",className:"parchment-input",value:w.hp,onChange:e=>C({...w,hp:e.target.value})}),(0,a.jsx)("input",{type:"number",placeholder:"Max HP",className:"parchment-input",value:w.maxHp,onChange:e=>C({...w,maxHp:e.target.value})}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsxs)("label",{className:"flex items-center gap-1 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:w.isNpc,onChange:e=>C({...w,isNpc:e.target.checked})})," NPC"]}),(0,a.jsx)(d.default,{type:"submit",children:"Add"})]})]})]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(r.default,{title:"ðŸŽ² Dice Rolls",children:(0,a.jsx)("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:0===h.length?(0,a.jsx)("p",{className:"text-xs text-[var(--ink-faded)] text-center",children:"No rolls yet. Use the dice tray!"}):h.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-xs p-1 bg-[var(--wood-dark)] rounded",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-[var(--gold)]",children:e.player_name})," ",e.expression]}),(0,a.jsx)("span",{className:"font-bold text-[var(--gold)]",children:e.total})]},t))})}),(0,a.jsxs)(r.default,{title:"ðŸ’¬ Session Chat",children:[(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto mb-2",children:0===u.length?(0,a.jsx)("p",{className:"text-xs text-[var(--ink-faded)] text-center",children:"No messages yet."}):u.map(e=>(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-[var(--gold)] font-bold",children:[e.player_name,": "]}),(0,a.jsx)("span",{children:e.text})]},e.comment_id))}),(0,a.jsxs)("form",{onSubmit:A,className:"flex gap-1",children:[(0,a.jsx)("input",{className:"parchment-input flex-1 text-xs",placeholder:"Message...",value:S,onChange:e=>k(e.target.value)}),(0,a.jsx)(d.default,{type:"submit",children:"Send"})]})]})]})]})]}):(0,a.jsx)(r.default,{title:"Error",children:(0,a.jsx)("p",{children:"No session ID provided."})})}e.s(["default",()=>x])}]);